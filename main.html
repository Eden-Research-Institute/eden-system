<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EDEN INSTITUTE - DASHBOARD</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=JetBrains+Mono:wght@400;700&display=swap');

        :root {
            --bg-color: #121212; --sidebar-bg: #1e1e1e; --card-bg: #252525;
            --border: #333; --accent: #00ff9d; --danger: #ff4b4b; --text-main: #ffffff; --text-sub: #888;
        }

        * { box-sizing: border-box; }
        body { margin: 0; padding: 0; background-color: var(--bg-color); color: var(--text-main); font-family: 'Inter', sans-serif; min-height: 100vh; overflow-x: hidden; }
        .mono { font-family: 'JetBrains Mono', monospace; }

        /* ì‚¬ì´ë“œë°” */
        .sidebar { width: 240px; height: 100vh; background-color: var(--sidebar-bg); border-right: 1px solid var(--border); position: fixed; top: 0; left: 0; display: flex; flex-direction: column; padding: 20px; z-index: 100; overflow-y: auto; }
        .logo { font-size: 16px; font-weight: 700; color: var(--accent); letter-spacing: 2px; margin-bottom: 40px; display: flex; align-items: center; gap: 10px; }
        .logo::before { content: 'â–'; font-size: 20px; }
        .menu-item { padding: 12px 15px; color: var(--text-sub); border-radius: 6px; margin-bottom: 4px; transition: 0.2s; font-size: 14px; display: flex; align-items: center; gap: 12px; font-weight: 500; text-decoration: none; }
        .menu-item:hover, .menu-item.active { background-color: rgba(0, 255, 157, 0.05); color: var(--accent); }
        .profile-box { margin-top: auto; padding-top: 20px; border-top: 1px solid var(--border); display: flex; align-items: center; gap: 12px; }
        .avatar { width: 32px; height: 32px; background: #333; border-radius: 4px; display: flex; justify-content: center; align-items: center; font-weight: bold; color: #fff; font-size: 14px; }
        .user-info { cursor: pointer; }
        .user-info:hover h4 { color: var(--accent); text-decoration: underline; }
        .user-info h4 { margin: 0; font-size: 13px; color: #fff; font-weight: 600; }
        .user-info p { margin: 0; font-size: 11px; color: var(--danger); margin-top: 3px; font-weight: bold;}

        /* ë©”ì¸ ì½˜í…ì¸  */
        .main-content { margin-left: 240px; padding: 30px; display: grid; grid-template-columns: 2fr 1fr; grid-template-rows: auto auto; gap: 20px; min-height: 100vh; }
        .header-area { grid-column: 1 / -1; display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 10px; border-bottom: 1px solid var(--border); padding-bottom: 15px; }
        .page-title h1 { margin: 0; font-size: 20px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;}
        .page-title p { margin: 5px 0 0; color: var(--text-sub); font-size: 12px; }
        .clock-area { text-align: right; display: block !important; }
        .clock-time { font-size: 24px; font-weight: 600; color: var(--text-main); letter-spacing: 1px; }
        .clock-date { font-size: 11px; color: var(--text-sub); margin-top: 2px; text-transform: uppercase; text-align: right;}

        /* ì¹´ë“œë“¤ */
        .card { background-color: var(--card-bg); border: 1px solid var(--border); border-radius: 8px; padding: 25px; position: relative; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .card-title { font-size: 12px; font-weight: 600; color: var(--text-sub); text-transform: uppercase; letter-spacing: 1px; }
        .status-dot { width: 8px; height: 8px; background: var(--accent); border-radius: 50%; box-shadow: 0 0 5px var(--accent); }
        
        .ripley-card { grid-column: 1 / 2; grid-row: 2 / 4; background: linear-gradient(160deg, #252525 0%, #1a1a1a 100%); border-left: 3px solid var(--accent); }
        .subject-id { font-size: 24px; font-weight: 600; color: #fff; letter-spacing: 1px; margin-bottom: 5px; display: flex; align-items: center; gap: 10px;}
        .subject-name-kr { font-size: 16px; color: var(--accent); font-weight: 400; }
        
        .subject-desc { font-size: 13px; color: #888; margin-top: 5px; line-height: 1.5;}
        .vital-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .vital-item { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.05); }
        .vital-label { font-size: 11px; color: #666; display: block; margin-bottom: 8px; letter-spacing: 0.5px; }
        .vital-value { font-size: 18px; font-weight: 600; color: #e0e0e0; }
        .bpm-value { color: var(--accent); font-size: 24px; }
        .monitor-line { width: 100%; height: 2px; background: #333; margin: 30px 0; position: relative; overflow: hidden; }
        .monitor-active { position: absolute; width: 100px; height: 100%; background: var(--accent); box-shadow: 0 0 15px var(--accent); animation: scan 2s infinite linear; }
        @keyframes scan { 0% { left: -20%; } 100% { left: 120%; } }

        .stats-card { grid-column: 2 / 3; }
        .stat-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .stat-row:last-child { border-bottom: none; }
        .stat-label { font-size: 13px; color: #aaa; }
        .stat-num { font-size: 14px; font-weight: 600; color: #fff; }

        .info-card { grid-column: 2 / 3; }
        .system-list div { padding: 8px 0; font-size: 13px; display: flex; justify-content: space-between; }
        .ok { color: var(--accent); } .warn { color: #ffaa00; } .lock { color: var(--danger); }

        /* ìˆ˜ì‹ í•¨ ëª¨ë‹¬ */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8); z-index: 2000; justify-content: center; align-items: center;
        }
        .inbox-container {
            width: 800px; height: 600px; background: #1e1e1e; border: 1px solid #444; border-radius: 8px;
            display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }
        .inbox-header {
            padding: 15px 20px; background: #252525; border-bottom: 1px solid #333;
            display: flex; justify-content: space-between; align-items: center;
        }
        .inbox-title { font-weight: bold; color: var(--accent); font-size: 14px; letter-spacing: 1px; }
        .close-btn { cursor: pointer; font-size: 20px; color: #888; } .close-btn:hover { color: #fff; }
        
        .inbox-body { display: flex; flex: 1; overflow: hidden; }
        .msg-list { width: 40%; border-right: 1px solid #333; overflow-y: auto; background: #1a1a1a; }
        .msg-item { padding: 15px; border-bottom: 1px solid #2a2a2a; cursor: pointer; transition: 0.2s; border-left: 3px solid transparent; }
        .msg-item:hover { background: #252525; }
        .msg-item.active { background: #2a2a2a; border-left-color: var(--accent); }
        .msg-item.unread .msg-sender, .msg-item.unread .msg-preview { font-weight: bold; color: #fff; }
        .msg-item.unread::after { content: 'â—'; float: right; color: var(--danger); font-size: 10px; margin-top: 3px;}
        .msg-sender { font-size: 12px; color: #ccc; display: block; margin-bottom: 4px; }
        .msg-type { font-size: 10px; padding: 2px 5px; border-radius: 3px; background: #333; color: #aaa; margin-right: 5px; }
        .msg-preview { font-size: 13px; color: #888; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .msg-content { flex: 1; padding: 30px; overflow-y: auto; background: #1e1e1e; }
        .view-header { border-bottom: 1px solid #333; padding-bottom: 20px; margin-bottom: 20px; }
        .view-subject { font-size: 18px; font-weight: bold; color: #fff; margin-bottom: 10px; }
        .view-meta { font-size: 12px; color: #666; }
        .view-body { font-size: 14px; line-height: 1.6; color: #ddd; white-space: pre-wrap; }
        .empty-state { text-align: center; color: #555; margin-top: 100px; font-size: 13px; }

        @media (max-width: 768px) {
            .sidebar { width: 100%; height: 55px; flex-direction: row; align-items: center; border-right: none; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; padding: 0 10px; padding-right: 130px; overflow-x: auto; white-space: nowrap; }
            .sidebar::-webkit-scrollbar { display: none; }
            .logo { display: none; }
            .menu-item { margin-bottom: 0; margin-right: 5px; background: #222; padding: 6px 10px; height: 36px; }
            .profile-box { position: fixed; top: 0; right: 0; width: 120px; height: 55px; background: #1a1a1a; border-left: 2px solid var(--border); border-top: none; display: flex !important; justify-content: center; z-index: 1000; padding: 0; margin: 0; box-shadow: -5px 0 10px rgba(0,0,0,0.5); }
            .main-content { margin-left: 0; padding: 15px; display: flex; flex-direction: column; }
            .header-area { flex-direction: column; align-items: flex-start; gap: 5px; }
            .clock-area { text-align: left; margin-top: 5px; }
            .inbox-container { width: 95%; height: 80%; }
            .inbox-body { flex-direction: column; }
            .msg-list { width: 100%; height: 40%; border-right: none; border-bottom: 1px solid #333; }
            .msg-content { height: 60%; }
            
            .subject-id { 
                flex-direction: column; 
                align-items: flex-start; 
                gap: 5px; 
                font-size: 20px; 
            }
        }
    </style>
</head>
<body>
    <nav class="sidebar">
        <div class="logo">EDEN LAB.</div>
        <a href="main.html" class="menu-item active"><span>ğŸ“Š</span> <span>ëŒ€ì‹œë³´ë“œ</span></a>
        <a href="subjects.html" class="menu-item"><span>ğŸ§¬</span> <span>ì‹¤í—˜ì²´ ê´€ë¦¬</span></a>
        <a href="facility.html" class="menu-item"><span>ğŸ¢</span> <span>ì‹œì„¤ ê´€ë¦¬</span></a>
        <a href="staff.html" class="menu-item"><span>ğŸ‘¥</span> <span>ì¡°ì§/ì¸ì‚¬</span></a>
        <a href="public.html" target="_blank" class="menu-item"><span>ğŸŒ</span> <span>ëŒ€ì™¸ í™ˆí˜ì´ì§€</span></a>
        <div class="profile-box">
            <div class="avatar">K</div>
            <div class="user-info" onclick="openInbox()">
                <h4>KAIRO</h4> <p style="color:var(--danger);">LEVEL 5</p>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <div class="header-area">
            <div class="page-title"><h1>Main Console</h1> <p>INTEGRATED CONTROL SYSTEM</p></div>
            <div class="clock-area mono"><div class="clock-time" id="clock">00:00:00</div><div class="clock-date" id="date">YYYY-MM-DD</div></div>
        </div>

        <div class="card ripley-card">
            <div class="card-header"><span class="card-title" style="color:var(--accent);">CORE ASSET MONITORING</span> <span class="status-dot"></span></div>
            <div class="subject-info">
                <div class="subject-id mono">
                    ER-S-02-001 <span class="subject-name-kr">(ë¦¬í”Œë¦¬)</span>
                </div>
                <div class="subject-desc">í˜„ì¬ ìœ ì¼í•œ 2ë‹¨ê³„(ì¬ìƒ) ë„ë‹¬ ê°œì²´.<br>ì‹ ì²´ ì¬ìƒ íš¨ìœ¨ 420% ìœ ì§€ ì¤‘.</div>
            </div>
            <div class="monitor-line"><div class="monitor-active"></div></div>
            <div class="vital-grid mono">
                <div class="vital-item"><span class="vital-label">HEART RATE</span><span class="vital-value bpm-value"><span id="bpm">72</span> <span style="font-size:12px;">BPM</span></span></div>
                <div class="vital-item"><span class="vital-label">CURRENT PHASE</span><span class="vital-value" style="color:#fff;">STAGE 2</span></div>
                <div class="vital-item"><span class="vital-label">BIOLOGICAL SEX</span><span class="vital-value" style="color:#fff;">FEMALE</span></div>
                <div class="vital-item"><span class="vital-label">CONDITION</span><span class="vital-value" style="color:var(--accent);">STABLE</span></div>
            </div>
        </div>

        <div class="card stats-card">
            <div class="card-header"><span class="card-title">SUBJECT STATUS</span></div>
            <div class="mono">
                <div class="stat-row"><span class="stat-label">ì´ ì‹¤í—˜ì²´ ìˆ˜ (Total)</span><span class="stat-num" id="stat-total">Loading...</span></div>
                <div class="stat-row"><span class="stat-label">í˜„ì¬ ìˆ˜ìš© (In Custody)</span><span class="stat-num" id="stat-active" style="color:var(--accent);">Loading...</span></div>
                <div class="stat-row"><span class="stat-label">ì‚¬ë§/íê¸° (Deceased)</span><span class="stat-num" id="stat-dead" style="color:#666;">Loading...</span></div>
                <div class="stat-row"><span class="stat-label">ê¸ˆì¼ ì‹ ê·œ ì…ì†Œ (New)</span><span class="stat-num" id="stat-new" style="color:#fff;">Loading...</span></div>
            </div>
        </div>

        <div class="card info-card">
            <div class="card-header"><span class="card-title">SYSTEM CHECK</span></div>
            <div class="system-list mono">
                <div><span>ë©”ì¸ ì„œë²„ (Main Server)</span> <span class="ok">ONLINE</span></div>
                <div><span>ë³´ì•ˆë§ (Security Grid)</span> <span class="ok">ARMED</span></div>
                <div><span>ê²©ë¦¬ ì‹œìŠ¤í…œ (Containment)</span> <span class="warn">CHECK</span></div>
                <div><span>ì™¸ë¶€ í†µì‹ ë§ (Network)</span> <span class="lock">OFFLINE</span></div>
            </div>
        </div>
    </main>

    <div class="modal-overlay" id="inbox-modal">
        <div class="inbox-container">
            <div class="inbox-header">
                <span class="inbox-title">SECURE INBOX (KAIRO)</span>
                <span class="close-btn" onclick="closeInbox()">&times;</span>
            </div>
            <div class="inbox-body">
                <div class="msg-list" id="msg-list-area"></div>
                <div class="msg-content" id="msg-content-area">
                    <div class="empty-state">ë©”ì‹œì§€ë¥¼ ì„ íƒí•˜ì—¬ ë‚´ìš©ì„ í™•ì¸í•˜ì‹­ì‹œì˜¤.</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 1. ì‹œê³„ ë° í†µê³„
        function updateClock() {
            const now = new Date();
            const kstTime = now.toLocaleTimeString('en-GB', { timeZone: 'Asia/Seoul', hour12: false });
            const kstDate = now.toLocaleDateString('en-CA', { timeZone: 'Asia/Seoul' });
            document.getElementById('clock').innerText = kstTime;
            document.getElementById('date').innerText = kstDate;
        }
        setInterval(updateClock, 1000); updateClock();

        function updateStats() {
            const startDate = new Date("2026-01-01T00:00:00+09:00").getTime();
            const today = new Date().getTime();
            const daysPassed = Math.floor((today - startDate) / (1000 * 60 * 60 * 24));
            const total = 1000 + (daysPassed * 3); 
            const dead = Math.floor(total * 0.58);
            const active = total - dead;
            const newIn = (daysPassed % 10) + 5; 
            document.getElementById('stat-total').innerText = total.toLocaleString();
            document.getElementById('stat-active').innerText = active.toLocaleString();
            document.getElementById('stat-dead').innerText = dead.toLocaleString();
            document.getElementById('stat-new').innerText = "+" + newIn;
        }
        updateStats();
        setInterval(() => { document.getElementById('bpm').innerText = Math.floor(Math.random() * (85 - 70 + 1)) + 70; }, 2000);

        // 2. ìˆ˜ì‹ í•¨ (INBOX) - â˜… ì¤‘ë³µ ë°©ì§€ + ë¡œê·¸ ë³´ì¡´ ë¡œì§ ì ìš© â˜…
        function safeLoad(key) {
            try { return JSON.parse(localStorage.getItem(key)) || []; } catch (e) { return []; }
        }

        const initialMessages = [
            { type: 'OFFICIAL', sender: 'êµ­ê°€ ê³¼í•™ ê¸°ìˆ  ìë¬¸íšŒì˜', title: '[ê¸°ë°€] 4ë¶„ê¸° ì˜ˆì‚° ì¦ì•¡ ìŠ¹ì¸', unread: true, date: 'Yesterday', body: 'ìˆ˜ì‹ : ì¹´ì´ë¡œ ì†Œì¥\n\nê·€í•˜ì˜ "ì¸ë¥˜ ì§„í™” í”„ë¡œì íŠ¸"ì— ëŒ€í•œ ì¶”ê°€ ì˜ˆì‚°ì•ˆì´ ë¹„ë°€ë¦¬ì— í†µê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.\nìœ¤ë¦¬ ìœ„ì›íšŒì˜ ê°ì‚¬ëŠ” ì˜ˆì •ëŒ€ë¡œ "ì„œë¥˜ìƒìœ¼ë¡œë§Œ" ì§„í–‰ë  ê²ƒì´ë‹ˆ\nì•ˆì‹¬í•˜ê³  ì—°êµ¬ì—ë§Œ ë§¤ì§„í•˜ì‹­ì‹œì˜¤.\n\nìš°ë¦¬ëŠ” ê·€í•˜ì˜ ì„±ê³¼ë¥¼ ê¸°ëŒ€í•˜ê³  ìˆìŠµë‹ˆë‹¤.\n\n- ìœ„ì›ì¥ ë“œë¦¼' },
            { type: 'OFFICIAL', sender: 'ì„¸ê³„ ìƒëª… ê³µí•™ í˜‘íšŒ', title: 'íŠ¹ë³„ ê³µë¡œìƒ ìˆ˜ìƒ í›„ë³´ ì„ ì •', unread: false, date: '2 days ago', body: 'ì¶•í•˜ë“œë¦½ë‹ˆë‹¤, ì¹´ì´ë¡œ ì†Œì¥ë‹˜.\nê·€í•˜ì˜ í˜ì‹ ì ì¸ ì—°êµ¬ ì„±ê³¼ë¥¼ ê¸°ë ¤ ê¸ˆë…„ë„ íŠ¹ë³„ ê³µë¡œìƒ ìœ ë ¥ í›„ë³´ë¡œ ì„ ì •ë˜ì…¨ìŠµë‹ˆë‹¤.\n(ì‹œìƒì‹ ì¼ì •ì€ ì¶”í›„ ëŒ€ì™¸ë¹„ë¡œ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.)' },
            { type: 'APPLY', sender: 'ì§€ì›ì„œ ì ‘ìˆ˜ ì‹œìŠ¤í…œ', title: '[ì‹ ê·œ ì§€ì›] Elias Weber', unread: true, date: 'Today', body: '[ì§€ì›ì ì •ë³´]\n- ì„±ëª…: Elias Weber\n- ìƒë…„ì›”ì¼: 1998-04-12\n- ì—°ë½ì²˜: +49 151 4920 3819\n\n[íŠ¹ì´ì‚¬í•­]\nê¸‰ì „ í•„ìš”í•¨\n\n----------------\n* 1ì°¨ ì í•©ì„± íŒì • ì™„ë£Œ. B2 ëŒ€ê¸°ì‹¤ ì´ì†¡ ê¶Œì¥.' },
            { type: 'APPLY', sender: 'ì§€ì›ì„œ ì ‘ìˆ˜ ì‹œìŠ¤í…œ', title: '[ì‹ ê·œ ì§€ì›] Mia Wagner', unread: true, date: 'Today', body: '[ì§€ì›ì ì •ë³´]\n- ì„±ëª…: Mia Wagner\n- ìƒë…„ì›”ì¼: 2001-11-23\n- ì—°ë½ì²˜: +49 170 3829 1023\n\n[íŠ¹ì´ì‚¬í•­]\nê°€ì¡± ì—†ìŒ, ì—°ê³ ì§€ ë¶ˆëª…\n\n----------------\n* 1ì°¨ ì í•©ì„± íŒì • ì™„ë£Œ. B2 ëŒ€ê¸°ì‹¤ ì´ì†¡ ê¶Œì¥.' }
        ];
        const randomEvents = [
            { sender: 'Dr. Vogel (Research)', title: 'â— 402ë²ˆ ê°œì²´ ì‡¼í¬ì‚¬ ë³´ê³ ', body: 'ì†Œì¥ë‹˜, 402ë²ˆ ê°œì²´ì—ì„œ ë¦¬í”Œë¦¬ì™€ ìœ ì‚¬í•œ ì‹ ê²½ ë°˜ì‘ì´ ê°ì§€ë˜ì—ˆìœ¼ë‚˜\nì•½ë¬¼ íˆ¬ì—¬ 10ë¶„ ë§Œì— ì‹¬ì •ì§€ë¡œ ì‚¬ë§í–ˆìŠµë‹ˆë‹¤.\n\ní•´ë¶€ ë°ì´í„° ì„œë²„ì— ì˜¬ë ¸ìŠµë‹ˆë‹¤. í™•ì¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤.' },
            { sender: 'Eng. Hans (Facility)', title: 'âš¡ B2 ì „ë ¥ ê³µê¸‰ ë¶ˆì•ˆì •', body: 'ì†Œì¥ë‹˜, ì§€í•˜ 2ì¸µ ì „ë ¥ ê³µê¸‰ ì¥ì¹˜ì—ì„œ ë¯¸ì„¸í•œ ì „ì•• ê°•í•˜ê°€ ê°ì§€ë©ë‹ˆë‹¤.\nì¦‰ì‹œ ë³µêµ¬ ì‘ì—… ì¤‘ì…ë‹ˆë‹¤ë§Œ, ë§Œì•½ì„ ìœ„í•´ ë¹„ìƒ ë°œì „ê¸°ë¥¼ ëŒ€ê¸°ì‹œì¼°ìŠµë‹ˆë‹¤.' },
            { sender: 'Dr. Weiss (Medical)', title: 'âš ï¸ ì§„ì •ì œ ì¬ê³  ë¶€ì¡± ì•Œë¦¼', body: 'í˜„ì¬ Bêµ¬ì—­ ì‹¤í—˜ì²´ë“¤ì˜ ë‚œë™ ë¹ˆë„ê°€ ëŠ˜ì–´ ì§„ì •ì œ ì†Œëª¨ê°€ ë¹ ë¦…ë‹ˆë‹¤.\nì¶”ê°€ ë°œì£¼ ìŠ¹ì¸ì„ ë¶€íƒë“œë¦½ë‹ˆë‹¤. (í˜„ì¬ ì¬ê³ : 15%)' },
            { sender: 'Security System', title: 'ğŸš¨ [ê²½ê³ ] í—ˆê°€ë˜ì§€ ì•Šì€ ì ‘ê·¼', body: '3ì¸µ ë°ì´í„° ì„œë²„ì‹¤ì— í—ˆê°€ë˜ì§€ ì•Šì€ IDì¹´ë“œë¡œ ì ‘ê·¼ ì‹œë„ê°€ ìˆì—ˆìŠµë‹ˆë‹¤.\në³´ì•ˆíŒ€ì´ ì¦‰ì‹œ ì¶œë™í•˜ì—¬ ìƒí™© ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.' },
            { sender: 'System Administrator', title: 'ğŸ’¾ ì •ê¸° ë°ì´í„° ë°±ì—… ì™„ë£Œ', body: 'ê¸ˆì¼ ì˜¤ì „ 04:00 ê¸°ì¤€ìœ¼ë¡œ ì „ì²´ ì—°êµ¬ ë°ì´í„°ì˜ í´ë¼ìš°ë“œ ë°±ì—…ì´ ì •ìƒì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\në°ì´í„° ë¬´ê²°ì„± ê²€ì‚¬ ê²°ê³¼: ì–‘í˜¸.' },
            { sender: 'Research Team 2', title: 'ë¹„í’ˆ(ê¸°ë¡ìš© íƒœë¸”ë¦¿) ì‹ ì²­ ê±´', body: 'ì†Œì¥ë‹˜, 2íŒ€ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê´€ì°° ê¸°ë¡ìš© íƒœë¸”ë¦¿ 3ëŒ€ê°€ íŒŒì†ë˜ì–´ êµì²´ ì‹ ì²­ì„œ ì˜¬ë ¸ìŠµë‹ˆë‹¤.\nê²°ì¬ ë¶€íƒë“œë¦½ë‹ˆë‹¤.' },
            { sender: 'Dr. Vogel (Research)', title: 'ì•¼ê°„ ê·¼ë¬´ì ì‹ë‹¨ ê°œì„  ìš”ì²­', body: 'ìµœê·¼ ì•¼ê°„ ì—°ì¥ ê·¼ë¬´ê°€ ëŠ˜ì–´ë‚˜ê³  ìˆëŠ”ë°, ì•¼ì‹ ë©”ë‰´ê°€ ë„ˆë¬´ ë¶€ì‹¤í•˜ë‹¤ëŠ” ì—°êµ¬ì›ë“¤ì˜ ë¶ˆë§Œì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.\nì˜ˆì‚° ë²”ìœ„ ë‚´ì—ì„œ ê°œì„ ì´ ê°€ëŠ¥í• ì§€ ê²€í†  ë¶€íƒë“œë¦½ë‹ˆë‹¤.' }
        ];

        function initializeInbox() {
            let messages = safeLoad('eden_messages');
            if (messages.length === 0) { messages = [...initialMessages]; localStorage.setItem('eden_messages', JSON.stringify(messages)); }
            
            let isInboxUpdated = false;

            // 1. ì§€ì›ì„œ ë¶ˆëŸ¬ì˜¤ê¸° (â˜… ì‚­ì œ X, ì¤‘ë³µ ì²´í¬ O â˜…)
            const applicants = safeLoad('eden_applicants');
            if (applicants.length > 0) {
                applicants.forEach(p => { 
                    // ì¤‘ë³µ ê²€ì‚¬: ê°™ì€ ì‹œê°„(date)ì— ê°™ì€ ì´ë¦„ìœ¼ë¡œ ì˜¨ ë©”ì¼ì´ ì´ë¯¸ ìˆëŠ”ì§€?
                    const isExist = messages.some(msg => msg.type === 'APPLY' && msg.date === p.time && msg.body.includes(p.name));
                    
                    if (!isExist) {
                        messages.unshift({ 
                            type: 'APPLY', 
                            sender: 'ì§€ì›ì„œ ì ‘ìˆ˜ ì‹œìŠ¤í…œ', 
                            title: `[ì‹ ê·œ ì§€ì›] ${p.name}`, 
                            unread: true, 
                            date: p.time, 
                            body: `[ì§€ì›ì ì •ë³´]\n- ì„±ëª…: ${p.name}\n- ìƒë…„ì›”ì¼: ${p.birth}\n- ì—°ë½ì²˜: ${p.phone}\n\n[íŠ¹ì´ì‚¬í•­]\n${p.note ? p.note : 'ì—†ìŒ'}\n\n----------------\n* 1ì°¨ ì í•©ì„± íŒì • ëŒ€ê¸° ì¤‘.` 
                        }); 
                        isInboxUpdated = true;
                    }
                });
                // localStorage.removeItem ì‚­ì œë¨ -> ë°ì´í„° ì˜êµ¬ ë³´ì¡´
            }

            // 2. ì™¸ë¶€ ë¬¸ì˜ ë©”ì¼ ë¶ˆëŸ¬ì˜¤ê¸° (â˜… ì‚­ì œ X, ì¤‘ë³µ ì²´í¬ O â˜…)
            const contacts = safeLoad('eden_contact_mails');
            if (contacts.length > 0) {
                contacts.forEach(m => {
                    // ì¤‘ë³µ ê²€ì‚¬: ê°™ì€ ì‹œê°„(date)ì— ê°™ì€ ë³´ë‚¸ì´(sender)ê°€ ìˆëŠ”ì§€?
                    const isExist = messages.some(msg => msg.type === 'EXT_MAIL' && msg.date === m.time && msg.sender === m.sender);

                    if (!isExist) {
                        messages.unshift({
                            type: 'EXT_MAIL', 
                            sender: m.sender,
                            title: `[ë¬¸ì˜] ${m.title}`,
                            unread: true,
                            date: m.time,
                            body: `[ì™¸ë¶€ í™ˆí˜ì´ì§€ ë¬¸ì˜ ì ‘ìˆ˜]\n\në³´ë‚¸ ì‚¬ëŒ: ${m.sender}\n\n[ë‚´ìš©]\n${m.body}\n\n----------------\n* ë³´ì•ˆ ê²€ì‚¬ ì™„ë£Œëœ ë©”ì‹œì§€ì…ë‹ˆë‹¤.`
                        });
                        isInboxUpdated = true;
                    }
                });
                // localStorage.removeItem ì‚­ì œë¨ -> ë°ì´í„° ì˜êµ¬ ë³´ì¡´
            }

            // 3. ëœë¤ ì´ë²¤íŠ¸ (ê¸°ì¡´: ì œëª© ì¤‘ë³µ ë°©ì§€)
            if (Math.random() < 0.3) { 
                const event = randomEvents[Math.floor(Math.random() * randomEvents.length)];
                const isDuplicate = messages.some(msg => msg.title === event.title);
                if (!isDuplicate) { 
                    messages.unshift({ type: 'MSG', sender: event.sender, title: event.title, unread: true, date: 'Now', body: event.body }); 
                    isInboxUpdated = true;
                }
            }

            if (isInboxUpdated) {
                localStorage.setItem('eden_messages', JSON.stringify(messages));
            }
        }
        initializeInbox();

        function openInbox() { renderList(); document.getElementById('inbox-modal').style.display = 'flex'; }
        function closeInbox() { document.getElementById('inbox-modal').style.display = 'none'; }
        function renderList() {
            const messages = safeLoad('eden_messages');
            const listArea = document.getElementById('msg-list-area');
            let html = '';
            messages.forEach((msg, idx) => {
                let badgeColor = '#888';
                if(msg.type === 'APPLY') badgeColor = '#ffaa00'; 
                if(msg.type === 'OFFICIAL') badgeColor = '#4facfe'; 
                if(msg.type === 'MSG') badgeColor = '#00ff9d'; 
                if(msg.type === 'EXT_MAIL') badgeColor = '#d946ef'; // ì™¸ë¶€ ë©”ì¼ì€ ë³´ë¼ìƒ‰

                const unreadClass = msg.unread ? 'unread' : '';
                html += `<div class="msg-item ${unreadClass}" onclick="viewMessage(${idx}, this)"><span class="msg-sender"><span class="msg-type" style="color:${badgeColor}; border:1px solid ${badgeColor};">${msg.type}</span>${msg.sender}</span><div class="msg-preview">${msg.title}</div></div>`;
            });
            listArea.innerHTML = html;
        }
        function viewMessage(idx, element) {
            let messages = safeLoad('eden_messages');
            const msg = messages[idx];
            const contentArea = document.getElementById('msg-content-area');
            if (msg.unread) { msg.unread = false; messages[idx] = msg; localStorage.setItem('eden_messages', JSON.stringify(messages)); }
            element.classList.remove('unread');
            const items = document.querySelectorAll('.msg-item'); items.forEach(i => i.classList.remove('active')); element.classList.add('active');
            contentArea.innerHTML = `<div class="view-header"><div class="view-subject">${msg.title}</div><div class="view-meta">From: ${msg.sender} | Date: ${msg.date}</div></div><div class="view-body">${msg.body}</div>`;
        }
    </script>
</body>
</html>
